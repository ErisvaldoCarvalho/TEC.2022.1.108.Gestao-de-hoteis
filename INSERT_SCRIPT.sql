USE GESTAO_HOTEL
GO

/*USE [master]
GO
ALTER DATABASE [GESTAO_HOTEL] SET  SINGLE_USER WITH ROLLBACK IMMEDIATE
GO
USE [master]
GO
DROP DATABASE [GESTAO_HOTEL]
GO*/

---CRIAÇÃO DE SCHEMA     Executar antes dos INSERT
CREATE SCHEMA CHECKIN;  
GO

CREATE SCHEMA CHECKOUT;  
GO

---CRIAÇÃO DE SEQUENCE     Executar antes dos INSERT
CREATE SEQUENCE CHECKIN.COUNTBY1
    START WITH 1  
    INCREMENT BY 1 ;  
GO

CREATE SEQUENCE CHECKOUT.COUNTBY1
    START WITH 1  
    INCREMENT BY 1 ;  
GO 

--COMANDOS PARA INSERÇÃO

--SEXO  --1º
INSERT INTO SEXO VALUES(1,'Feminino')
INSERT INTO SEXO VALUES(2,'Masculino')

-- CLIENTE  --7º
INSERT INTO CLIENTE VALUES('Marcos Antonio','19854267923',1,'1995-06-17','marcoant@hotmail.com','99981506471','Rua dos Jumentos')
INSERT INTO CLIENTE VALUES('Larissa Silva','95586257412',2,'1994-12-19','larissasilva@gmail.com','82963145789','Aveniva Presidente Dutra')
INSERT INTO CLIENTE VALUES('Larnivaldo Souza','48215974536',1,'1999-07-01','lsouza_23@hotmail.com','94982653415','Rua dos Jatobás')

-- DIARIA  --12º
INSERT INTO RESERVA VALUES('2023-05-18','2023-05-20',500.00,1,2,2,1,'Carro preto placa: JK59L3',250.00,1,'2023-05-18','2023-05-20','Nada','Nada',NEXT VALUE FOR CHECKIN.COUNTBY1,NEXT VALUE FOR CHECKOUT.COUNTBY1)
--INSERT INTO RESERVA VALUES('2023-05-18','2023-05-20',500.00,1,2,2,1,'Carro preto placa: JK59L3',250.00,1,'2023-05-18','2023-05-20')
--INSERT INTO RESERVA VALUES('2023-05-18','2023-05-20',500.00,1,2,2,1,'Carro preto placa: JK59L3',250.00,1,'2023-05-18','2023-05-20')


-- QUARTO  --11º
INSERT INTO QUARTO VALUES('01',1,'Quarto de solteiro',90.00,'A1',1)
INSERT INTO QUARTO VALUES('02',2,'Quarto de casal',150.00,'A1',1)
INSERT INTO QUARTO VALUES('03',3,'Quarto de casal',300.00,'A1',1)
INSERT INTO QUARTO VALUES('04',1,'Quarto de solteiro',100.00,'A1',2)
INSERT INTO QUARTO VALUES('05',3,'Quarto de casal',300.00,'A1',1)

--DIARIA_QUARTO  --13º
INSERT INTO RESERVA_QUARTO VALUES(1,1)
INSERT INTO RESERVA_QUARTO VALUES(2,2)

-- STATUS  --8º
INSERT INTO STATUS VALUES(1,'Disponível')
INSERT INTO STATUS VALUES(2,'Ocupado')
INSERT INTO STATUS VALUES(3,'Reservado')
INSERT INTO STATUS VALUES(4,'Manutenção')

-- CLASSE  --9º
INSERT INTO CLASSE VALUES(1,'Standard')
INSERT INTO CLASSE VALUES(2,'Master')
INSERT INTO CLASSE VALUES(3,'Deluxe')

--PAGAMENTO  --10º
INSERT INTO PAGAMENTO VALUES('Cartão de Crédito')
INSERT INTO PAGAMENTO VALUES('Cartão de Débito')
INSERT INTO PAGAMENTO VALUES('À vista (Boleto)')
INSERT INTO PAGAMENTO VALUES('Dinheiro')
INSERT INTO PAGAMENTO VALUES('PIX')

--FUNCIONARIO  --2º
INSERT INTO FUNCIONARIO VALUES('08432576522','Administrador','admin@gmail.com','63984581203','Rua A1, 010','admin','admin',2,1,GETDATE())
INSERT INTO FUNCIONARIO VALUES('94587124563','Laila Silva','lailassantos@gmail.com','63991587425','Avenida dos Cedros, 45','laila_santos','wads135',1,1,GETDATE())
INSERT INTO FUNCIONARIO VALUES('62518745259','Roziane Alves Santos','rozialvess@hotelogix.com','98995632547','Rua das Capivaras, 915','Roziane Alves','rozi3142',2,1,GETDATE())

--GRUPO_FUNCIONARIO  --3º
INSERT INTO GRUPO_FUNCIONARIO(NOME_GRUPO)VALUES('Administrador')
INSERT INTO GRUPO_FUNCIONARIO(NOME_GRUPO)VALUES('Gerente')
INSERT INTO GRUPO_FUNCIONARIO(NOME_GRUPO)VALUES('Recepsionista')
INSERT INTO GRUPO_FUNCIONARIO(NOME_GRUPO)VALUES('Gorvenanta')

--PERMISSAO  --4º
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Visualizar funcionário') --1
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Cadastrar funcionário') --2
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Alterar funcionário') --3
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Excluir funcionário') --4
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Visualizar grupo de funcionário') --5
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Cadastrar grupo de funcionário') --6
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Alterar grupo de funcionário') --7
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Excluir grupo de funcionário') --8
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Visualizar cliente') --9
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Cadastrar cliente') --10
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Alterar cliente') --11
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Excluir cliente') --12
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Visualizar diária') --13
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Cadastrar diária') --14
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Alterar diária') --15
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Excluir diária') --16
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Visualizar quarto') --17
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Cadastrar quarto') --18
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Alterar quarto') --19
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Excluir quarto') --20
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Adicionar permissão a um grupo de funcionário') --21
INSERT INTO PERMISSAO(DESCRICAO)VALUES('Adicionar grupo de funcionário a um funcionário') --22

--PERMISSAO_GRUPO_FUNCIONARIO  --5º
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,1)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,2)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,3)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,4)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,5)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,6)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,7)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,8)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,9)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,10)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,11)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,12)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,13)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,14)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,15)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,16)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,17)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,18)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,19)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,20)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,21)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(1,22)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,1)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,2)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,3)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,4)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,5)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,6)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,7)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,8)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,9)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,10)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,11)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,12)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,13)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,14)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,15)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,16)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,17)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,18)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,19)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,20)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,21)
INSERT INTO PERMISSAO_GRUPO_FUNCIONARIO(ID_GRUPO_FUNCIONARIO,ID_PERMISSAO)VALUES(2,22)

--FUNCIONARIO_GRUPO_FUNCIONARIO  --6º
INSERT INTO FUNCIONARIO_GRUPO_FUNCIONARIO(ID_FUNCIONARIO,ID_GRUPO_FUNCIONARIO)VALUES(1,1)
INSERT INTO FUNCIONARIO_GRUPO_FUNCIONARIO(ID_FUNCIONARIO,ID_GRUPO_FUNCIONARIO)VALUES(2,2)


-----------------------------------------------------------------------------------------------------------------

--COMANDOS PARA SELECT
SELECT * FROM FUNCIONARIO
SELECT * FROM GRUPO_FUNCIONARIO
SELECT * FROM FUNCIONARIO_GRUPO_FUNCIONARIO
SELECT * FROM PERMISSAO_GRUPO_FUNCIONARIO
SELECT * FROM CLIENTE
SELECT * FROM SEXO
SELECT * FROM RESERVA
SELECT * FROM RESERVA_QUARTO
SELECT * FROM QUARTO
SELECT * FROM CLASSE
SELECT * FROM STATUS
SELECT * FROM PAGAMENTO
SELECT * FROM PERMISSAO

-----------------------------------------------------------------------------------------------------------------

-- CODIGO INNER JOIN DE BUSCAR POR NOME 
SELECT D.ID, C.NOME, C.CPF, D.VALOR_TOTAL, D.DATA_ENTRADA, D.ID_CLIENTE, D.ID_FUNCIONARIO, D.ID_PAGAMENTO, D.DATA_SAIDA, D.DATA_ENTRADA
FROM DIARIA D
INNER JOIN CLIENTE C ON D.ID_CLIENTE = C.ID
WHERE C.NOME LIKE '%Lar%'

-- CODIGO INNER JOIN DE BUSCAR POR CPF 
SELECT D.ID, C.NOME, C.CPF, D.VALOR_TOTAL, D.DATA_ENTRADA, D.ID_CLIENTE, D.ID_FUNCIONARIO, D.ID_PAGAMENTO, D.DATA_SAIDA, D.DATA_ENTRADA
FROM DIARIA D
INNER JOIN CLIENTE C ON D.ID_CLIENTE = C.ID
WHERE C.CPF LIKE '19854267923'

--CODIGO INNER JOIN BUSCAR POR NOMEUSUARIO EM FUNCIONARIO
SELECT F.ID, F.NOME, F.ID_SEXO, SEXO.SEXO,F.NOME_USUARIO, GF.NOME_GRUPO, F.EMAIL ,F.SENHA ,F.CPF, F.ATIVO, F.DATA_NASCIMENTO,F.ENDERECO, F.CELULAR, F.ID_SEXO 
FROM FUNCIONARIO F
INNER JOIN FUNCIONARIO_GRUPO_FUNCIONARIO FGF ON F.ID = FGF.ID_FUNCIONARIO
INNER JOIN GRUPO_FUNCIONARIO GF ON FGF.ID_GRUPO_FUNCIONARIO = GF.ID
INNER JOIN SEXO ON SEXO.ID = F.ID_SEXO

SELECT QUARTO.ID, QUARTO.NUMERO, QUARTO.ID_CLASSE, QUARTO.DESCRICAO, QUARTO.VALOR_DIARIA, QUARTO.ANDAR, QUARTO.ID_STATUS FROM QUARTO
                                    INNER JOIN RESERVA_QUARTO ON QUARTO.ID = RESERVA_QUARTO.ID_QUARTO
                                    WHERE RESERVA_QUARTO.ID_RESERVA

SELECT GRUPO_FUNCIONARIO.ID, GRUPO_FUNCIONARIO.NOME_GRUPO FROM GRUPO_FUNCIONARIO
                                    INNER JOIN FUNCIONARIO_GRUPO_FUNCIONARIO ON GRUPO_FUNCIONARIO.ID = FUNCIONARIO_GRUPO_FUNCIONARIO.ID_GRUPO_FUNCIONARIO
                                    WHERE FUNCIONARIO_GRUPO_FUNCIONARIO.ID_FUNCIONARIO

SELECT D.ID, C.NOME, C.CPF, D.VALOR_TOTAL, D.DATA_ENTRADA, D.ID_CLIENTE,
                                    D.ID_FUNCIONARIO, D.ID_PAGAMENTO, D.DATA_SAIDA, D.DATA_ENTRADA
                                    FROM DIARIA D
                                    INNER JOIN CLIENTE C ON D.ID_CLIENTE = C.ID
                                    WHERE C.NOME LIKE '%Laris%'

SELECT Q.ID, Q.NUMERO, Q.ID_CLASSE, CLASSE.CLASSE, Q.DESCRICAO, Q.VALOR_DIARIA, Q.ANDAR, Q.ID_STATUS, S.STATUS
                                    FROM QUARTO Q
                                    INNER JOIN CLASSE ON CLASSE.ID = Q.ID_CLASSE
                                    INNER JOIN STATUS S ON S.ID = Q.ID_STATUS
                                    WHERE S.STATUS LIKE 'Disponível'

----------------------------------TRIGGER---------------------------------------
Create trigger QUARTO_DIARIA 
on DIARIA_QUARTO
for insert 
as 
begin
Declare 
   @status int,
   @codigo int 
     SELECT @codigo= ID_QUARTO FROM inserted

   
 select @status = 2 from QUARTO
   update QUARTO set ID_STATUS = @status where ID = @codigo
   end 
------------------------------APAGER A TRIGGER---------------------------------------
   Drop trigger QUARTO_DIARIA
   --------------------------------------------------------------------------------